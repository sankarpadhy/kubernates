<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Kubernetes Learning</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        // Initialize Mermaid with specific configuration
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                showSequenceNumbers: false,
                boxMargin: 10
            }
        });

        // Function to manually render Mermaid diagrams
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.init(undefined, '.mermaid');
        });
    </script>
    <style>
        .terminal-output {
            background-color: #1e1e1e;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .command-input {
            background-color: #1e1e1e !important;
            color: #fff !important;
            font-size: 0.9rem;
        }
        .command-input::placeholder {
            color: #6c757d;
        }
        .exercise-step {
            background-color: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .code-examples {
            max-height: 300px;
            overflow-y: auto;
        }
        .example-item {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .setup-step {
            background-color: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            border-left: 4px solid #28a745;
        }
        .setup-command {
            background-color: #1e1e1e;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 0;
        }
        .setup-command:hover {
            background-color: #2d2d2d;
        }
        .step-status {
            margin-top: 5px;
            font-size: 0.9rem;
        }
        .step-status.success {
            color: #28a745;
        }
        .step-status.error {
            color: #dc3545;
        }
        .setup-info {
            background-color: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #17a2b8;
        }
        .step-description {
            color: #6c757d;
            font-size: 0.95rem;
            margin-bottom: 10px;
        }
        .setup-info {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #17a2b8;
        }
        .setup-command-container {
            margin-top: 15px;
            background-color: #2d2d2d;
            border-radius: 4px;
            padding: 15px;
        }
        .setup-command {
            color: #fff;
            font-family: monospace;
            margin: 0;
            cursor: pointer;
            position: relative;
            padding: 10px;
            background-color: #1e1e1e;
            border-radius: 4px;
            border: 1px solid #444;
        }
        .setup-command:hover {
            background-color: #2d2d2d;
            border-color: #666;
        }
        .setup-command::before {
            content: '$ ';
            color: #666;
        }
        .copy-indicator {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.2s;
        }
        .setup-command:hover .copy-indicator {
            opacity: 0.7;
        }
        .step-description {
            color: #6c757d;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        .setup-step {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .setup-step h6 {
            color: #0d6efd;
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .setup-step h6 i {
            font-size: 1.2em;
        }
        .expected-header {
            font-weight: 600;
            color: #198754;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .command-label {
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .verification-list {
            list-style: none;
            padding: 0;
            margin: 0 0 15px 0;
        }
        .verification-list li {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            color: #495057;
        }
        .verification-list li i {
            color: #198754;
        }
        .warning-note {
            font-size: 0.9rem;
            color: #664d03;
            background-color: #fff3cd;
            border: 1px solid #ffecb5;
            border-radius: 4px;
            padding: 8px 12px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">Kubernetes Interactive Learning</a>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row mb-4">
            <!-- Setup Environment Card -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Setup Environment</h4>
                        <button class="btn btn-light btn-sm" onclick="checkEnvironment()">Check Environment</button>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <strong>Prerequisites:</strong> Make sure you have the following installed:
                            <ul>
                                <li>Docker Desktop (version 4.0.0 or higher)</li>
                                <li>kubectl CLI (version 1.20.0 or higher)</li>
                                <li>minikube (version 1.25.0 or higher)</li>
                            </ul>
                        </div>
                        <div class="setup-steps">
                            <h5>Quick Start Steps:</h5>
                            <div class="step-list">
                                <div class="setup-step" data-step="1">
                                    <h6><i class="bi bi-1-circle-fill"></i>Verify Docker Installation</h6>
                                    <p class="step-description">Let's verify that Docker is properly installed and running on your system.</p>
                                    
                                    <div class="setup-info">
                                        <div class="expected-header">
                                            <i class="bi bi-check-circle"></i>Expected Configuration
                                        </div>
                                        <ul class="verification-list">
                                            <li><i class="bi bi-dot"></i>Docker version 4.0.0 or higher</li>
                                            <li><i class="bi bi-dot"></i>Docker daemon running</li>
                                            <li><i class="bi bi-dot"></i>Linux containers mode enabled</li>
                                        </ul>
                                        
                                        <div class="command-label">
                                            <i class="bi bi-terminal"></i>Run this command to verify:
                                        </div>
                                        <div class="setup-command-container">
                                            <pre class="setup-command" onclick="copyCommand(this)">docker --version && docker info<span class="copy-indicator"><i class="bi bi-clipboard"></i></span></pre>
                                        </div>
                                    </div>
                                    <div class="step-status"></div>
                                </div>

                                <div class="setup-step" data-step="2">
                                    <h6><i class="bi bi-2-circle-fill"></i>Verify kubectl Installation</h6>
                                    <p class="step-description">Check if kubectl is installed and properly configured.</p>
                                    
                                    <div class="setup-info">
                                        <div class="expected-header">
                                            <i class="bi bi-check-circle"></i>Expected Configuration
                                        </div>
                                        <ul class="verification-list">
                                            <li><i class="bi bi-dot"></i>kubectl version 1.20.0 or higher</li>
                                            <li><i class="bi bi-dot"></i>No connection errors</li>
                                        </ul>
                                        
                                        <div class="command-label">
                                            <i class="bi bi-terminal"></i>Run this command to verify:
                                        </div>
                                        <div class="setup-command-container">
                                            <pre class="setup-command" onclick="copyCommand(this)">kubectl version --client<span class="copy-indicator"><i class="bi bi-clipboard"></i></span></pre>
                                        </div>
                                    </div>
                                    <div class="step-status"></div>
                                </div>

                                <div class="setup-step" data-step="3">
                                    <h6><i class="bi bi-3-circle-fill"></i>Start Local Kubernetes Cluster</h6>
                                    <p class="step-description">Initialize a local Kubernetes cluster using minikube.</p>
                                    
                                    <div class="setup-info">
                                        <div class="expected-header">
                                            <i class="bi bi-check-circle"></i>Expected Configuration
                                        </div>
                                        <ul class="verification-list">
                                            <li><i class="bi bi-dot"></i>minikube version 1.25.0 or higher</li>
                                            <li><i class="bi bi-dot"></i>Docker driver configured</li>
                                            <li><i class="bi bi-dot"></i>Kubernetes v1.26.0 or higher</li>
                                        </ul>
                                        
                                        <div class="command-label">
                                            <i class="bi bi-terminal"></i>Run these commands to start:
                                        </div>
                                        <div class="setup-command-container">
                                            <pre class="setup-command" onclick="copyCommand(this)">minikube version<span class="copy-indicator"><i class="bi bi-clipboard"></i></span></pre>
                                            <pre class="setup-command mt-2" onclick="copyCommand(this)">minikube start --driver=docker --kubernetes-version=v1.26.0<span class="copy-indicator"><i class="bi bi-clipboard"></i></span></pre>
                                        </div>
                                        
                                        <div class="warning-note">
                                            <i class="bi bi-exclamation-triangle"></i>
                                            This step may take a few minutes to complete as it downloads necessary components.
                                        </div>
                                    </div>
                                    <div class="step-status"></div>
                                </div>

                                <div class="setup-step" data-step="4">
                                    <h6><i class="bi bi-4-circle-fill"></i>Verify Cluster Status</h6>
                                    <p class="step-description">Ensure the Kubernetes cluster is running properly.</p>
                                    
                                    <div class="setup-info">
                                        <div class="expected-header">
                                            <i class="bi bi-check-circle"></i>Expected Configuration
                                        </div>
                                        <ul class="verification-list">
                                            <li><i class="bi bi-dot"></i>Control plane is running</li>
                                            <li><i class="bi bi-dot"></i>CoreDNS is active</li>
                                            <li><i class="bi bi-dot"></i>Node status shows "Ready"</li>
                                        </ul>
                                        
                                        <div class="command-label">
                                            <i class="bi bi-terminal"></i>Run these commands to verify:
                                        </div>
                                        <div class="setup-command-container">
                                            <pre class="setup-command" onclick="copyCommand(this)">kubectl cluster-info<span class="copy-indicator"><i class="bi bi-clipboard"></i></span></pre>
                                            <pre class="setup-command mt-2" onclick="copyCommand(this)">kubectl get nodes -o wide<span class="copy-indicator"><i class="bi bi-clipboard"></i></span></pre>
                                        </div>
                                    </div>
                                    <div class="step-status"></div>
                                </div>

                                <div class="setup-step" data-step="5">
                                    <h6><i class="bi bi-5-circle-fill"></i>Enable Required Addons</h6>
                                    <p class="step-description">Enable necessary minikube addons for monitoring and management.</p>
                                    
                                    <div class="setup-info">
                                        <div class="expected-header">
                                            <i class="bi bi-check-circle"></i>Expected Configuration
                                        </div>
                                        <ul class="verification-list">
                                            <li><i class="bi bi-dot"></i>metrics-server enabled for resource monitoring</li>
                                            <li><i class="bi bi-dot"></i>dashboard enabled for visual management</li>
                                        </ul>
                                        
                                        <div class="command-label">
                                            <i class="bi bi-terminal"></i>Run these commands to enable addons:
                                        </div>
                                        <div class="setup-command-container">
                                            <pre class="setup-command" onclick="copyCommand(this)">minikube addons enable metrics-server<span class="copy-indicator"><i class="bi bi-clipboard"></i></span></pre>
                                            <pre class="setup-command mt-2" onclick="copyCommand(this)">minikube addons enable dashboard<span class="copy-indicator"><i class="bi bi-clipboard"></i></span></pre>
                                            <pre class="setup-command mt-2" onclick="copyCommand(this)">minikube addons list<span class="copy-indicator"><i class="bi bi-clipboard"></i></span></pre>
                                        </div>
                                    </div>
                                    <div class="step-status"></div>
                                </div>
                            </div>
                        </div>
                        <div id="environment-status" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- First Row - Diagram and Interactive Exercises -->
        <div class="row mb-4">
            <!-- Architecture Diagram -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">Kubernetes Architecture</h4>
                    </div>
                    <div class="card-body">
                        <pre class="mermaid">
                            graph TB
                            subgraph "Control Plane"
                                style Control Plane fill:#e3f2fd,stroke:#1565c0
                                API[API Server]
                                ETCD[etcd]
                                CM[Controller Manager]
                                SCHED[Scheduler]
                                
                                API --> ETCD
                                CM --> API
                                SCHED --> API
                            end
                            
                            subgraph "Worker Node 1"
                                style Worker Node 1 fill:#f5f5f5,stroke:#424242
                                KL1[Kubelet]
                                KP1[Kube Proxy]
                                CR1[Container Runtime]
                                
                                KL1 --> CR1
                                KP1 --> CR1
                            end
                            
                            subgraph "Worker Node 2"
                                style Worker Node 2 fill:#f5f5f5,stroke:#424242
                                KL2[Kubelet]
                                KP2[Kube Proxy]
                                CR2[Container Runtime]
                                
                                KL2 --> CR2
                                KP2 --> CR2
                            end
                            
                            API --> KL1
                            API --> KL2
                            
                            classDef component fill:#bbdefb,stroke:#1976d2,color:#000
                            class API,ETCD,CM,SCHED,KL1,KL2,KP1,KP2,CR1,CR2 component
                        </pre>
                    </div>
                </div>
            </div>

            <!-- Interactive Exercises -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">Interactive Exercises</h4>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" onclick="startExercise('pods')">Pod Lifecycle</button>
                            <button class="btn btn-primary" onclick="startExercise('services')">Service Networking</button>
                            <button class="btn btn-primary" onclick="startExercise('deployment')">Deployment Strategy</button>
                        </div>
                        <div id="exerciseOutput" class="mt-3" style="height: 300px; overflow-y: auto;">
                            <!-- Exercise output will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Second Row - Component Explorer, Examples, and Terminal -->
        <div class="row">
            <!-- Component Explorer -->
            <div class="col-lg-3">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">Component Explorer</h4>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-column gap-2">
                            <button class="btn btn-outline-primary w-100" onclick="showDetails('apiserver')">API Server</button>
                            <button class="btn btn-outline-primary w-100" onclick="showDetails('etcd')">etcd</button>
                            <button class="btn btn-outline-primary w-100" onclick="showDetails('kubelet')">Kubelet</button>
                            <button class="btn btn-outline-primary w-100" onclick="showDetails('kubeproxy')">Kube Proxy</button>
                            <button class="btn btn-outline-primary w-100" onclick="showDetails('scheduler')">Scheduler</button>
                            <button class="btn btn-outline-primary w-100" onclick="showDetails('controllermanager')">Controller Manager</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Examples Panel -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">Examples</h4>
                    </div>
                    <div class="card-body" style="height: 400px; overflow-y: auto;">
                        <div id="examplesPanel">
                            <!-- Examples will be loaded here based on selected component -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kubernetes Terminal -->
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        <h4 class="mb-0">Kubernetes Terminal</h4>
                    </div>
                    <div class="card-body bg-dark">
                        <div id="commandOutput" class="terminal-output mb-3" style="height: 350px; overflow-y: auto; color: #fff; font-family: monospace;">
                            <!-- Command output will appear here -->
                        </div>
                        <div class="input-group">
                            <span class="input-group-text bg-dark text-white border-0">$</span>
                            <input type="text" class="form-control bg-dark text-white border-0 command-input" 
                                   placeholder="Type kubectl command..." 
                                   onkeypress="handleCommand(event)"
                                   style="font-family: monospace;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Exercise definitions
        const exercises = {
            pods: {
                title: 'Pod Lifecycle Visualization',
                steps: [
                    { 
                        action: 'Creating Pod Manifest',
                        detail: 'kubectl create -f pod.yaml',
                        explanation: 'API Server receives the pod creation request',
                        delay: 1000 
                    },
                    { 
                        action: 'Validating Pod Specification',
                        detail: 'API Server validates the pod configuration',
                        explanation: 'Checking resource requirements and quotas',
                        delay: 1500 
                    },
                    { 
                        action: 'Scheduling Pod',
                        detail: 'Scheduler selects optimal node',
                        explanation: 'Evaluating node resources and rules',
                        delay: 2000 
                    },
                    { 
                        action: 'Creating Containers',
                        detail: 'Pulling images and creating containers',
                        explanation: 'Container runtime starts containers',
                        delay: 2500 
                    }
                ],
                diagram: `sequenceDiagram
                    participant U as User
                    participant A as API Server
                    participant S as Scheduler
                    participant K as Kubelet
                    U->>A: Create Pod
                    A->>S: Schedule Pod
                    S-->>A: Node Selected
                    A->>K: Create Pod
                    K-->>A: Pod Running`
            },
            services: {
                title: 'Service Networking Exercise',
                steps: [
                    { 
                        action: 'Creating Service',
                        detail: 'kubectl create service',
                        explanation: 'Creating a new service',
                        delay: 1000 
                    },
                    { 
                        action: 'Configuring Endpoints',
                        detail: 'Service selecting pod endpoints',
                        explanation: 'Matching pods with labels',
                        delay: 1500 
                    }
                ],
                diagram: `sequenceDiagram
                    participant U as User
                    participant A as API Server
                    participant K as Kube Proxy
                    U->>A: Create Service
                    A->>K: Update Rules
                    K-->>A: Rules Updated`
            },
            deployment: {
                title: 'Deployment Strategy Exercise',
                steps: [
                    { 
                        action: 'Creating Deployment',
                        detail: 'kubectl create deployment',
                        explanation: 'Setting up deployment',
                        delay: 1000 
                    },
                    { 
                        action: 'Scaling Replicas',
                        detail: 'Creating ReplicaSets',
                        explanation: 'Managing pod replicas',
                        delay: 1500 
                    }
                ],
                diagram: `sequenceDiagram
                    participant U as User
                    participant A as API Server
                    participant D as Deployment
                    U->>A: Create Deployment
                    A->>D: Create Pods
                    D-->>A: Pods Ready`
            }
        };

        // Function to start exercise
        function startExercise(type) {
            const exercise = exercises[type];
            if (!exercise) return;

            const container = document.getElementById('exerciseOutput');
            container.innerHTML = `
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">${exercise.title}</h5>
                    </div>
                    <div class="card-body">
                        <div class="progress mb-3" style="height: 20px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 0%">
                            </div>
                        </div>
                        <div id="exerciseSteps"></div>
                        <div class="mt-3">
                            <h6>Sequence Diagram:</h6>
                            <pre class="mermaid">
                                ${exercise.diagram}
                            </pre>
                        </div>
                    </div>
                </div>
            `;

            // Re-initialize Mermaid for the new diagram
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));

            const stepsDiv = document.getElementById('exerciseSteps');
            const progressBar = container.querySelector('.progress-bar');
            let currentStep = 0;

            function runStep() {
                if (currentStep < exercise.steps.length) {
                    const step = exercise.steps[currentStep];
                    const stepElement = document.createElement('div');
                    stepElement.className = 'exercise-step';
                    stepElement.innerHTML = `
                        <div class="d-flex align-items-center">
                            <div class="spinner-border spinner-border-sm me-2"></div>
                            <div>
                                <strong>${step.action}</strong>
                                <div class="text-muted small">${step.detail}</div>
                                <div class="text-info small">${step.explanation}</div>
                            </div>
                        </div>
                    `;
                    stepsDiv.appendChild(stepElement);

                    const progress = ((currentStep + 1) / exercise.steps.length) * 100;
                    progressBar.style.width = `${progress}%`;

                    setTimeout(() => {
                        stepElement.innerHTML = `
                            <div class="d-flex align-items-center">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <div>
                                    <strong>${step.action}</strong>
                                    <div class="text-muted small">${step.detail}</div>
                                    <div class="text-info small">${step.explanation}</div>
                                </div>
                            </div>
                        `;
                        currentStep++;
                        runStep();
                    }, step.delay);
                }
            }

            runStep();
        }

        // Function to execute command in Docker environment and show result
        async function executeCommand(command) {
            const output = document.getElementById('commandOutput');
            output.innerHTML += `<div class="command-line">> ${command}</div>`;
            
            try {
                const response = await fetch('/execute-command', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command: command })
                });
                
                const result = await response.text();
                output.innerHTML += `<div class="command-response">${result}</div>`;
            } catch (error) {
                output.innerHTML += `<div class="command-response error">Error executing command: ${error.message}</div>`;
            }
            
            output.scrollTop = output.scrollHeight;
        }

        // Update command input handler
        function handleCommand(event) {
            if (event.key === 'Enter') {
                const input = event.target;
                const command = input.value.trim();
                
                if (command) {
                    executeCommand(command);
                    input.value = '';
                }
            }
        }

        // Function to show component details and examples
        function showDetails(component) {
            const details = componentDetails[component];
            if (!details) return;

            const examplesPanel = document.getElementById('examplesPanel');
            let examplesHtml = '';

            details.examples.forEach(example => {
                examplesHtml += `
                    <div class="example-item">
                        <div class="example-title">${example.title}</div>
                        <pre class="example-code" onclick="copyCommand(this)">${example.code}</pre>
                        <div class="example-description">${example.description}</div>
                    </div>
                `;
            });

            examplesPanel.innerHTML = `
                <h4>${details.title}</h4>
                <p class="mb-4">${details.description}</p>
                <h5>Examples:</h5>
                ${examplesHtml}
            `;
        }

        // Function to copy command to clipboard and populate terminal
        function copyCommand(element) {
            const text = element.textContent;
            const commandInput = document.querySelector('.command-input');
            
            // Copy to clipboard
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback
                const originalBackground = element.style.backgroundColor;
                element.style.backgroundColor = '#28a745';
                element.style.color = 'white';
                setTimeout(() => {
                    element.style.backgroundColor = originalBackground;
                    element.style.color = '';
                }, 500);
            });

            // Populate terminal input and execute
            if (commandInput) {
                commandInput.value = text;
                executeCommand(text);
            }
        }

        // Component details with examples and commands
        const componentDetails = {
            apiserver: {
                title: 'API Server',
                description: 'The Kubernetes API server validates and configures data for the api objects which include pods, services, replicationcontrollers, and others.',
                examples: [
                    {
                        title: 'List Resources',
                        code: 'kubectl get pods -n default',
                        description: 'List all pods in default namespace'
                    },
                    {
                        title: 'Create Resource',
                        code: 'kubectl create -f deployment.yaml',
                        description: 'Create a resource from YAML file'
                    },
                    {
                        title: 'Describe Resource',
                        code: 'kubectl describe pod my-pod',
                        description: 'Get detailed information about a pod'
                    }
                ]
            },
            etcd: {
                title: 'etcd',
                description: 'etcd is a consistent and highly-available key value store used as Kubernetes\' backing store for all cluster data.',
                examples: [
                    {
                        title: 'Backup etcd',
                        code: 'etcdctl snapshot save backup.db',
                        description: 'Create a snapshot of the etcd database'
                    },
                    {
                        title: 'Check Health',
                        code: 'etcdctl endpoint health',
                        description: 'Check the health of etcd cluster'
                    },
                    {
                        title: 'List Members',
                        code: 'etcdctl member list',
                        description: 'List all etcd cluster members'
                    }
                ]
            },
            kubelet: {
                title: 'Kubelet',
                description: 'The kubelet is the primary "node agent" that runs on each node. It ensures that containers are running in a Pod.',
                examples: [
                    {
                        title: 'Check Status',
                        code: 'systemctl status kubelet',
                        description: 'Check kubelet service status'
                    },
                    {
                        title: 'View Logs',
                        code: 'journalctl -u kubelet',
                        description: 'View kubelet logs'
                    },
                    {
                        title: 'Configure',
                        code: 'kubelet --config=/var/lib/kubelet/config.yaml',
                        description: 'Start kubelet with config file'
                    }
                ]
            },
            kubeproxy: {
                title: 'Kube Proxy',
                description: 'Kube-proxy maintains network rules on nodes. These network rules allow network communication to your Pods from network sessions inside or outside of your cluster.',
                examples: [
                    {
                        title: 'Check Rules',
                        code: 'iptables -t nat -L KUBE-SERVICES',
                        description: 'List kube-proxy service rules'
                    },
                    {
                        title: 'View Config',
                        code: 'kubectl -n kube-system get cm kube-proxy -o yaml',
                        description: 'View kube-proxy configuration'
                    },
                    {
                        title: 'Check Status',
                        code: 'kubectl -n kube-system get pods | grep kube-proxy',
                        description: 'List kube-proxy pods'
                    }
                ]
            },
            scheduler: {
                title: 'Scheduler',
                description: 'The Kubernetes scheduler is a control plane process which assigns Pods to Nodes. The scheduler determines which Nodes are valid placements for each Pod.',
                examples: [
                    {
                        title: 'Pod Assignment',
                        code: 'kubectl get events | grep Scheduled',
                        description: 'View pod scheduling events'
                    },
                    {
                        title: 'Node Selection',
                        code: 'kubectl label node worker-1 disktype=ssd',
                        description: 'Label a node for scheduling'
                    },
                    {
                        title: 'Pod Placement',
                        code: 'kubectl get pod -o wide',
                        description: 'View pod placement on nodes'
                    }
                ]
            },
            controllermanager: {
                title: 'Controller Manager',
                description: 'The Kubernetes controller manager is a daemon that embeds the core control loops shipped with Kubernetes.',
                examples: [
                    {
                        title: 'Check Controllers',
                        code: 'kubectl get deployments --all-namespaces',
                        description: 'List all deployments'
                    },
                    {
                        title: 'Scale Resources',
                        code: 'kubectl scale deployment nginx --replicas=3',
                        description: 'Scale a deployment'
                    },
                    {
                        title: 'View Status',
                        code: 'kubectl get pods -l app=nginx',
                        description: 'List pods managed by controller'
                    }
                ]
            }
        };

        // Enhanced function to check environment status with version comparisons
        async function checkEnvironment() {
            const steps = document.querySelectorAll('.setup-step');
            const envStatus = document.getElementById('environment-status');
            envStatus.innerHTML = '<div class="alert alert-info">Checking environment...</div>';
            
            let allSuccess = true;
            
            for (const step of steps) {
                const command = step.querySelector('.setup-command').textContent;
                const statusDiv = step.querySelector('.step-status');
                statusDiv.innerHTML = '<i class="bi bi-hourglass-split"></i> Checking...';
                
                try {
                    const response = await fetch('/execute-command', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ command })
                    });
                    
                    const result = await response.text();
                    
                    // Version checks and specific validations
                    let isValid = true;
                    let message = '';
                    
                    if (command.includes('docker --version')) {
                        const versionMatch = result.match(/Docker version (\d+\.\d+\.\d+)/);
                        if (versionMatch) {
                            const version = versionMatch[1];
                            if (compareVersions(version, '4.0.0') < 0) {
                                isValid = false;
                                message = `Docker version ${version} is outdated. Please upgrade to 4.0.0 or higher.`;
                            }
                        }
                        if (!result.includes('Docker daemon is running')) {
                            isValid = false;
                            message = 'Docker daemon is not running. Please start Docker Desktop.';
                        }
                    }
                    else if (command.includes('kubectl version')) {
                        const versionMatch = result.match(/Client Version: v(\d+\.\d+\.\d+)/);
                        if (versionMatch) {
                            const version = versionMatch[1];
                            if (compareVersions(version, '1.20.0') < 0) {
                                isValid = false;
                                message = `kubectl version ${version} is outdated. Please upgrade to 1.20.0 or higher.`;
                            }
                        }
                    }
                    else if (command.includes('minikube version')) {
                        const versionMatch = result.match(/minikube version: v(\d+\.\d+\.\d+)/);
                        if (versionMatch) {
                            const version = versionMatch[1];
                            if (compareVersions(version, '1.25.0') < 0) {
                                isValid = false;
                                message = `minikube version ${version} is outdated. Please upgrade to 1.25.0 or higher.`;
                            }
                        }
                    }
                    
                    if (isValid && response.ok && !result.toLowerCase().includes('error')) {
                        statusDiv.className = 'step-status success';
                        statusDiv.innerHTML = '<i class="bi bi-check-circle"></i> Success';
                        if (message) {
                            statusDiv.innerHTML += `<br><small>${message}</small>`;
                        }
                    } else {
                        statusDiv.className = 'step-status error';
                        statusDiv.innerHTML = `<i class="bi bi-x-circle"></i> Failed${message ? ': ' + message : ''}`;
                        allSuccess = false;
                    }
                } catch (error) {
                    statusDiv.className = 'step-status error';
                    statusDiv.innerHTML = '<i class="bi bi-x-circle"></i> Error: ' + error.message;
                    allSuccess = false;
                }
            }
            
            if (allSuccess) {
                envStatus.innerHTML = '<div class="alert alert-success"><i class="bi bi-check-circle-fill"></i> Environment is ready! You can now proceed with the exercises.</div>';
            } else {
                envStatus.innerHTML = '<div class="alert alert-warning"><i class="bi bi-exclamation-triangle-fill"></i> Some environment checks failed. Please review the steps above and ensure all prerequisites are properly installed and up to date.</div>';
            }
        }

        // Version comparison helper function
        function compareVersions(a, b) {
            const pa = a.split('.');
            const pb = b.split('.');
            for (let i = 0; i < 3; i++) {
                const na = Number(pa[i]);
                const nb = Number(pb[i]);
                if (na > nb) return 1;
                if (nb > na) return -1;
                if (!isNaN(na) && isNaN(nb)) return 1;
                if (isNaN(na) && !isNaN(nb)) return -1;
            }
            return 0;
        }
    </script>
</body>
</html>